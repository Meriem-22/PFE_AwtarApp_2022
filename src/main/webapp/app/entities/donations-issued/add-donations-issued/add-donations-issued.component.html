<div class="container py-5">
  <div class="row">
    <div class="col-md-12 col-md-offset-3">
      <form [formGroup]="DonationsIssued" id="msform">
        <!-- progressbar -->

        <!-- fieldsets -->
        <fieldset *ngIf="step == 1">
          <h1 class="fs-title" style="margin-bottom: 2rem">Ajouter un don émis</h1>

          <div class="Dons">
            <jhi-alert-error></jhi-alert-error>

            <div class="row" style="margin-bottom: 1rem">
              <label class="form-label" jhiTranslate="awtarApp.donationsIssued.model" for="field_model">Model</label>
              <input type="text" class="form-control" name="model" id="field_model" data-cy="model" formControlName="model" />
              <div
                *ngIf="
                  DonationsIssued_step &&
                  DonationsIssued.get('model')!.invalid &&
                  (DonationsIssued.get('model')!.dirty || DonationsIssued.get('model')!.touched)
                "
              >
                <small
                  class="form-text text-danger"
                  *ngIf="DonationsIssued.get('model')?.errors?.required"
                  jhiTranslate="entity.validation.required"
                >
                  This field is required.
                </small>
              </div>
            </div>

            <div class="blok1" style="display: flex; margin-right: 1rem">
              <div class="row mb-3" style="margin-right: 5rem">
                <label class="form-label" jhiTranslate="awtarApp.donationsIssued.isValidated" for="field_isValidated">Is Validated</label>
                <input
                  type="checkbox"
                  class="form-check"
                  name="isValidated"
                  id="field_isValidated"
                  data-cy="isValidated"
                  formControlName="isValidated"
                />
              </div>

              <div class="row mb-3">
                <label class="form-label" jhiTranslate="awtarApp.donationsIssued.donationsDate" for="field_donationsDate"
                  >Donations Date</label
                >
                <div class="input-group">
                  <input
                    id="field_donationsDate"
                    data-cy="donationsDate"
                    type="text"
                    class="form-control"
                    name="donationsDate"
                    ngbDatepicker
                    #donationsDateDp="ngbDatepicker"
                    formControlName="donationsDate"
                  />
                  <button type="button" class="btn btn-secondary" (click)="donationsDateDp.toggle()">
                    <fa-icon icon="calendar-alt"></fa-icon>
                  </button>
                </div>
              </div>
            </div>

            <div class="blok1" style="display: flex; margin-top: 2rem">
              <div class="row mb-3" style="margin-right: 5rem">
                <label class="form-label" jhiTranslate="awtarApp.donationsIssued.recurringDonations" for="field_recurringDonations"
                  >Recurring Donations</label
                >
                <input
                  type="checkbox"
                  class="form-check"
                  name="recurringDonations"
                  id="field_recurringDonations"
                  data-cy="recurringDonations"
                  formControlName="recurringDonations"
                />
              </div>

              <div class="row mb-3" style="margin-right: 5rem">
                <label class="form-label" jhiTranslate="awtarApp.donationsIssued.periodicity" for="field_periodicity">Periodicity</label>
                <select class="form-control" name="periodicity" formControlName="periodicity" id="field_periodicity" data-cy="periodicity">
                  <option [ngValue]="null">{{ 'awtarApp.Period.null' | translate }}</option>
                  <option *ngFor="let period of periodValues" [value]="period">{{ 'awtarApp.Period.' + period | translate }}</option>
                </select>

                <div class="row mb-3">
                  <label class="form-label" jhiTranslate="awtarApp.donationsIssued.recurrence" for="field_recurrence">Recurrence</label>
                  <input
                    type="number"
                    class="form-control"
                    name="recurrence"
                    id="field_recurrence"
                    data-cy="recurrence"
                    formControlName="recurrence"
                  />
                </div>
              </div>
            </div>
            <div class="blok1" style="display: flex; margin-top: 2rem">
              <div class="row mb-3" style="margin-right: 5rem">
                <label class="form-label" for="field_beneficiaryType">Beneficiary Type</label>
                <select
                  class="form-control"
                  name="beneficiaryType"
                  formControlName="beneficiaryType"
                  id="field_beneficiaryType"
                  data-cy="beneficiaryType"
                >
                  <option [ngValue]="null">{{ 'awtarApp.Beneficiaries.null' | translate }}</option>
                  <option *ngFor="let beneficiaries of beneficiariesValues" [value]="beneficiaries">
                    {{ 'awtarApp.Beneficiaries.' + beneficiaries | translate }}
                  </option>
                </select>
                <div
                  *ngIf="
                    DonationsIssued_step &&
                    DonationsIssued.get('beneficiaryType')!.invalid &&
                    (DonationsIssued.get('beneficiaryType')!.dirty || DonationsIssued.get('beneficiaryType')!.touched)
                  "
                >
                  <small
                    class="form-text text-danger"
                    *ngIf="DonationsIssued_step && DonationsIssued.get('beneficiaryType')?.errors?.required"
                    jhiTranslate="entity.validation.required"
                  >
                    This field is required.
                  </small>
                </div>
              </div>

              <div class="row mb-3">
                <label class="form-label" jhiTranslate="awtarApp.donationDetails.nature" for="field_nature">Nature</label>
                <select class="form-control" id="field_nature" data-cy="nature" name="nature" formControlName="nature">
                  <option *ngIf="DonationsIssued_step && !DonationsIssued.get('nature')!.value" [ngValue]="null" selected></option>
                  <option
                    [ngValue]="
                      natureOption.id === DonationsIssued.get('nature')!.value?.id ? DonationsIssued.get('nature')!.value : natureOption
                    "
                    *ngFor="let natureOption of naturesSharedCollection; trackBy: trackNatureById"
                  >
                    {{ natureOption.name }}
                  </option>
                </select>
              </div>
              <div
                *ngIf="
                  DonationsIssued_step &&
                  DonationsIssued.get(['nature'])!.invalid &&
                  (DonationsIssued.get(['nature'])!.dirty || DonationsIssued.get(['nature'])!.touched)
                "
              >
                <small
                  class="form-text text-danger"
                  *ngIf="DonationsIssued.get(['nature'])?.errors?.required"
                  jhiTranslate="entity.validation.required"
                >
                  This field is required.
                </small>
              </div>
            </div>

            <div class="row mb-3">
              <label class="form-label" jhiTranslate="awtarApp.donationsIssued.archivated" for="field_archivated">Archivated</label>
              <input
                type="checkbox"
                class="form-check"
                name="archivated"
                id="field_archivated"
                data-cy="archivated"
                formControlName="archivated"
              />
            </div>
          </div>
          <div class="button" style="margin-left: 70rem">
            <input (click)="previousState()" type="button" name="next" class="next action-button" value="Annuler" />
            <input (click)="next()" type="button" name="next" class="next action-button" value="Next" />
          </div>
        </fieldset>
      </form>

      <form [formGroup]="DonationsDetails" id="msform">
        <fieldset *ngIf="step == 2">
          <h1 class="fs-title" style="margin-bottom: 2rem">Détails des dons émis</h1>

          <div>
            <jhi-alert-error></jhi-alert-error>

            <div class="row mb-3">
              <label class="form-label" jhiTranslate="awtarApp.donationDetails.description" for="field_description">Description</label>
              <input
                type="text"
                class="form-control"
                name="description"
                id="field_description"
                data-cy="description"
                formControlName="description"
              />
              <div
                *ngIf="
                  DonationsDetails_step &&
                  DonationsDetails.get('description')!.invalid &&
                  (DonationsDetails.get('description')!.dirty || DonationsDetails.get('description')!.touched)
                "
              >
                <small
                  class="form-text text-danger"
                  *ngIf="DonationsDetails_step && DonationsDetails.get('description')?.errors?.required"
                  jhiTranslate="entity.validation.required"
                >
                  This field is required.
                </small>
              </div>
            </div>
          </div>

          <div class="cont1">
            <h3 style="margin-top: 2rem; margin-bottom: 3rem">Choisissez les bénéficiaires auxquels vous souhaitez attribuer le don :</h3>

            <div class="beneficiaires" style="align-items: center">
              <div class="table-responsive" id="entities" *ngIf="childrenProfiles && childrenProfiles.length > 0">
                <tbody>
                  <tr>
                    <td *ngFor="let profile of childrenProfiles" data-cy="entityTable">
                      <div class="col" style="width: 22rem; height: 30rem; margin-right: 2rem">
                        <div class="card shadow-sm">
                          <img
                            *ngIf="profile.urlPhoto"
                            (click)="openFile(profile.urlPhoto, profile.urlPhotoContentType)"
                            class="bd-placeholder-img card-img-top"
                            [src]="'data:' + profile.urlPhotoContentType + ';base64,' + profile.urlPhoto"
                            alt="profile image"
                            role="img"
                            aria-label="Placeholder: Thumbnail"
                            preserveAspectRatio="xMidYMid slice"
                            focusable="false"
                            style="height: 20rem; width: 20rem"
                          />

                          <div class="card-body">
                            <p class="card-text">{{ profile.lastName }} {{ profile.firstName }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                              <label class="slds-checkbox-button" for="example-unique-id-3">
                                <input
                                  type="checkbox"
                                  (click)="addBeneficiary(profile.id!)"
                                  class="slds-assistive-text"
                                  id="example-unique-id-3"
                                  value="example-unique-id-3"
                                  style="height: 3rem; width: 3rem"
                                />
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </div>

              <div class="table-responsive" id="entities" *ngIf="familys && familys.length > 0">
                <tbody>
                  <tr>
                    <td *ngFor="let family of familys" data-cy="entityTable">
                      <div class="col" style="width: 22rem; height: 30rem; margin-right: 2rem">
                        <div class="card shadow-sm">
                          <div class="card-body">
                            <p class="card-text">{{ family.familyName }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                              <label class="slds-checkbox-button" for="example-unique-id-3">
                                <input
                                  type="checkbox"
                                  (click)="addBeneficiary(family.id!)"
                                  class="slds-assistive-text"
                                  id="example-unique-id-3"
                                  value="example-unique-id-3"
                                  style="height: 3rem; width: 3rem"
                                />
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </div>

              <div class="table-responsive" id="entities" *ngIf="establishments && establishments.length > 0">
                <tbody>
                  <tr>
                    <td *ngFor="let establishment of establishments" data-cy="entityTable">
                      <div class="col" style="width: 22rem; height: 30rem; margin-right: 2rem">
                        <div class="card shadow-sm">
                          <div class="card-body">
                            <p class="card-text">{{ establishment.name }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                              <label class="slds-checkbox-button" for="example-unique-id-3">
                                <input
                                  type="checkbox"
                                  (click)="addBeneficiary(establishment.id!)"
                                  class="slds-assistive-text"
                                  id="example-unique-id-3"
                                  value="example-unique-id-3"
                                  style="height: 3rem; width: 3rem"
                                />
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </div>
            </div>
          </div>

          <div class="cont2" style="margin-top: 1.5rem; margin-bottom: 3rem">
            <h3 style="margin-top: 1rem; margin-bottom: 2rem">Choisissez les articles de donation en indiquant la quantité de chacun :</h3>

            <div class="items">
              <div class="table-responsive" id="entities" *ngIf="items && items.length > 0">
                <tbody>
                  <tr>
                    <td *ngFor="let item of items" data-cy="entityTable">
                      <div class="col" style="width: 20rem; height: 10; margin-right: 2rem">
                        <div class="card shadow-sm">
                          <img
                            *ngIf="item.urlPhoto"
                            (click)="openFile(item.urlPhoto, item.urlPhotoContentType)"
                            class="bd-placeholder-img card-img-top"
                            [src]="'data:' + item.urlPhotoContentType + ';base64,' + item.urlPhoto"
                            alt="profile image"
                            role="img"
                            aria-label="Placeholder: Thumbnail"
                            preserveAspectRatio="xMidYMid slice"
                            focusable="false"
                            style="height: 20rem; width: 20rem"
                          />

                          <div class="card-body">
                            <p class="card-text">{{ item.name }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                              <div class="row mb-3" style="margin-left: 1rem">
                                <label class="form-label" jhiTranslate="awtarApp.donationItemDetails.quantity" for="field_quantity"
                                  >Quantity</label
                                >
                                <input
                                  type="number"
                                  class="form-control"
                                  name="quantity"
                                  id="field_quantity"
                                  data-cy="quantity"
                                  formControlName="quantity"
                                />
                                <div
                                  *ngIf="
                                    DonationsDetails_step &&
                                    DonationsDetails.get('quantity')!.invalid &&
                                    (DonationsDetails.get('quantity')!.dirty || DonationsDetails.get('quantity')!.touched)
                                  "
                                >
                                  <small
                                    class="form-text text-danger"
                                    *ngIf="DonationsDetails.get('quantity')?.errors?.required"
                                    jhiTranslate="entity.validation.required"
                                  >
                                    This field is required.
                                  </small>
                                  <small
                                    class="form-text text-danger"
                                    [hidden]="!DonationsDetails.get('quantity')?.errors?.number"
                                    jhiTranslate="entity.validation.number"
                                  >
                                    This field should be a number.
                                  </small>
                                </div>
                              </div>

                              <label class="slds-checkbox-button" for="example-unique-id-3" style="margin-left: 1rem">
                                <input
                                  type="checkbox"
                                  (click)="addItem(item!)"
                                  class="slds-assistive-text"
                                  id="example-unique-id-3"
                                  value="example-unique-id-3"
                                  style="height: 2.5rem; width: 3rem; margin-top: +1rem"
                                />
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </div>
            </div>
          </div>

          <input (click)="previous()" type="button" name="previous" class="previous action-button-previous" value="Précedent" />
          <input (click)="submit()" type="submit" name="submit" class="submit action-button" value="Enregistrer" />
        </fieldset>
      </form>
    </div>
  </div>
</div>
